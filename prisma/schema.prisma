generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                           String                            @id @default(cuid())
  email                        String                            @unique
  username                     String                            @unique
  password                     String
  firstName                    String
  lastName                     String
  phone                        String?
  avatar                       String?
  role                         String                            @default("USER")
  isActive                     Boolean                           @default(true)
  isEmailVerified              Boolean                           @default(false)
  createdAt                    DateTime                          @default(now())
  updatedAt                    DateTime                          @updatedAt
  lastLoginAt                  DateTime?
  employee                     Employee?                         @relation("EmployeeUser")
  userSubscriptions            ReportSubscription[]              @relation("UserSubscriptions")
  resourceLocks                ResourceLock[]
  scheduledReportDistributions ScheduledReportDistributionList[]
  calculatedPerformances       SupplierPerformance[]             @relation("PerformanceCalculator")
  reviewedPerformances         SupplierPerformance[]             @relation("PerformanceReviewer")
  resolvedEvents               SupplierPerformanceEvent[]        @relation("EventResolver")
  conductedReviews             SupplierPerformanceReview[]       @relation("PerformanceReviewBy")

  @@index([email])
  @@index([isActive])
  @@map("users")
}

model Session {
  id           String   @id @default(cuid())
  userId       String
  token        String   @unique
  refreshToken String?  @unique
  expiresAt    DateTime
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("sessions")
}

model ProductCategory {
  id          String    @id @default(cuid())
  name        String
  description String?
  parentId    String?
  level       Int       @default(0)
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  products    Product[]

  @@index([parentId])
  @@index([isActive])
  @@index([level])
  @@map("product_categories")
}

model Product {
  id                String               @id @default(cuid())
  name              String
  sku               String               @unique
  description       String?
  price             Decimal              @db.Decimal(10, 2)
  categoryId        String
  status            String               @default("ACTIVE")
  stockQuantity     Int                  @default(0)
  lowStockThreshold Int                  @default(10)
  isActive          Boolean              @default(true)
  createdAt         DateTime             @default(now())
  updatedAt         DateTime             @updatedAt
  orderItems        OrderItem[]          @relation("OrderProductItems")
  category          ProductCategory      @relation(fields: [categoryId], references: [id])
  stockMovements    StockMovement[]      @relation("ProductStockMovements")
  inventoryValuations InventoryValuation[]
  costLayers        CostLayer[]
  lowStockAlerts    LowStockAlert[]

  @@index([categoryId])
  @@index([status])
  @@index([isActive])
  @@index([stockQuantity])
  @@map("products")
}

model StockMovement {
  id          String   @id @default(cuid())
  productId   String
  type        String   @default("IN")
  quantity    Int
  reason      String
  reference   String?
  createdById String?
  createdAt   DateTime @default(now())
  product     Product  @relation("ProductStockMovements", fields: [productId], references: [id])

  @@index([productId])
  @@index([type])
  @@index([createdAt])
  @@map("stock_movements")
}

model ChartOfAccounts {
  id             String            @id @default(cuid())
  code           String            @unique(map: "chart_of_accounts_code_unique")
  name           String
  description    String?
  type           String
  category       String
  subcategory    String?
  parentId       String?
  level          Int               @default(0)
  isActive       Boolean           @default(true)
  isSystem       Boolean           @default(false)
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  createdBy      String?
  updatedBy      String?
  parent         ChartOfAccounts?  @relation("AccountHierarchy", fields: [parentId], references: [id])
  children       ChartOfAccounts[] @relation("AccountHierarchy")
  journalEntries JournalEntry[]

  @@index([type])
  @@index([category])
  @@index([parentId])
  @@index([isActive])
  @@map("chart_of_accounts")
}

model Transaction {
  id          String         @id @default(cuid())
  reference   String         @unique(map: "transactions_reference_unique")
  description String
  date        DateTime       @default(now())
  amount      Decimal        @db.Decimal(15, 2)
  currency    String         @default("USD")
  status      String         @default("PENDING")
  type        String
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  createdBy   String?
  updatedBy   String?
  postedBy    String?
  postedAt    DateTime?
  entries     JournalEntry[]

  @@index([date])
  @@index([status])
  @@index([type])
  @@index([createdBy])
  @@map("transactions")
}

model JournalEntry {
  id            String          @id @default(cuid())
  transactionId String
  accountId     String
  description   String?
  debitAmount   Decimal         @default(0) @db.Decimal(15, 2)
  creditAmount  Decimal         @default(0) @db.Decimal(15, 2)
  balance       Decimal         @default(0) @db.Decimal(15, 2)
  createdAt     DateTime        @default(now())
  account       ChartOfAccounts @relation(fields: [accountId], references: [id])
  transaction   Transaction     @relation(fields: [transactionId], references: [id])

  @@index([transactionId])
  @@index([accountId])
  @@index([debitAmount])
  @@index([creditAmount])
  @@map("journal_entries")
}

model Customer {
  id          String    @id @default(cuid())
  code        String    @unique
  name        String
  email       String    @unique
  phone       String?
  address     String?
  city        String?
  state       String?
  postalCode  String?
  country     String?
  taxId       String?
  isActive    Boolean   @default(true)
  creditLimit Decimal   @default(0) @db.Decimal(15, 2)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  createdBy   String?
  updatedBy   String?
  invoices    Invoice[]
  orders      Order[]

  @@index([isActive])
  @@index([email])
  @@map("customers")
}

model Order {
  id          String      @id @default(cuid())
  orderNumber String      @unique
  customerId  String
  reference   String?
  description String?
  status      String      @default("DRAFT")
  orderDate   DateTime    @default(now())
  dueDate     DateTime?
  subtotal    Decimal     @default(0) @db.Decimal(15, 2)
  taxAmount   Decimal     @default(0) @db.Decimal(15, 2)
  totalAmount Decimal     @default(0) @db.Decimal(15, 2)
  currency    String      @default("USD")
  notes       String?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  createdBy   String?
  updatedBy   String?
  invoice     Invoice?
  orderItems  OrderItem[]
  customer    Customer    @relation(fields: [customerId], references: [id])

  @@index([customerId])
  @@index([status])
  @@index([orderDate])
  @@index([totalAmount])
  @@map("orders")
}

model OrderItem {
  id          String   @id @default(cuid())
  orderId     String
  productId   String
  quantity    Int
  unitPrice   Decimal  @db.Decimal(10, 2)
  discount    Decimal  @default(0) @db.Decimal(10, 2)
  totalPrice  Decimal  @default(0) @db.Decimal(15, 2)
  description String?
  createdAt   DateTime @default(now())
  order       Order    @relation(fields: [orderId], references: [id])
  product     Product  @relation("OrderProductItems", fields: [productId], references: [id])

  @@index([orderId])
  @@index([productId])
  @@map("order_items")
}

model Invoice {
  id            String    @id @default(cuid())
  invoiceNumber String    @unique
  orderId       String    @unique
  customerId    String
  status        String    @default("DRAFT")
  issueDate     DateTime  @default(now())
  dueDate       DateTime?
  subtotal      Decimal   @default(0) @db.Decimal(15, 2)
  taxAmount     Decimal   @default(0) @db.Decimal(15, 2)
  totalAmount   Decimal   @default(0) @db.Decimal(15, 2)
  paidAmount    Decimal   @default(0) @db.Decimal(15, 2)
  balanceDue    Decimal   @default(0) @db.Decimal(15, 2)
  currency      String    @default("USD")
  notes         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  createdBy     String?
  updatedBy     String?
  customer      Customer  @relation(fields: [customerId], references: [id])
  order         Order     @relation(fields: [orderId], references: [id])
  payments      Payment[]

  @@index([customerId])
  @@index([status])
  @@index([issueDate])
  @@index([dueDate])
  @@map("invoices")
}

model Payment {
  id            String   @id @default(cuid())
  invoiceId     String
  reference     String?
  amount        Decimal  @db.Decimal(15, 2)
  paymentMethod String
  paymentDate   DateTime @default(now())
  status        String   @default("PENDING")
  notes         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  createdBy     String?
  updatedBy     String?
  invoice       Invoice  @relation(fields: [invoiceId], references: [id])

  @@index([invoiceId])
  @@index([status])
  @@index([paymentDate])
  @@index([amount])
  @@map("payments")
}

model Supplier {
  id                 String                      @id @default(cuid())
  code               String                      @unique
  name               String
  email              String                      @unique
  phone              String?
  address            String?
  city               String?
  state              String?
  postalCode         String?
  country            String?
  taxId              String?
  isActive           Boolean                     @default(true)
  creditLimit        Decimal                     @default(0) @db.Decimal(15, 2)
  paymentTerms       String                      @default("NET30")
  createdAt          DateTime                    @default(now())
  updatedAt          DateTime                    @updatedAt
  createdBy          String?
  updatedBy          String?
  purchaseOrders     PurchaseOrder[]
  performanceRecords SupplierPerformance[]
  performanceEvents  SupplierPerformanceEvent[]  @relation("SupplierEvents")
  performanceReviews SupplierPerformanceReview[] @relation("SupplierReviews")

  @@index([isActive])
  @@index([email])
  @@map("suppliers")
}

model PurchaseOrder {
  id                String                     @id @default(cuid())
  orderNumber       String                     @unique
  supplierId        String
  reference         String?
  description       String?
  status            String                     @default("DRAFT")
  orderDate         DateTime                   @default(now())
  expectedDate      DateTime?
  subtotal          Decimal                    @default(0) @db.Decimal(15, 2)
  taxAmount         Decimal                    @default(0) @db.Decimal(15, 2)
  totalAmount       Decimal                    @default(0) @db.Decimal(15, 2)
  currency          String                     @default("USD")
  notes             String?
  deletedAt         DateTime?
  createdAt         DateTime                   @default(now())
  updatedAt         DateTime                   @updatedAt
  createdBy         String?
  updatedBy         String?
  orderItems        PurchaseOrderItem[]
  supplier          Supplier                   @relation(fields: [supplierId], references: [id])
  receipts          PurchaseReceipt[]
  performanceEvents SupplierPerformanceEvent[] @relation("OrderEvents")

  @@index([supplierId])
  @@index([status])
  @@index([orderDate])
  @@index([totalAmount])
  @@index([deletedAt])
  @@map("purchase_orders")
}

model PurchaseOrderItem {
  id                String                     @id @default(cuid())
  orderId           String
  productId         String?
  description       String
  quantity          Int
  unitPrice         Decimal                    @db.Decimal(10, 2)
  discount          Decimal                    @default(0) @db.Decimal(10, 2)
  totalPrice        Decimal                    @default(0) @db.Decimal(15, 2)
  receivedQty       Int                        @default(0)
  createdAt         DateTime                   @default(now())
  order             PurchaseOrder              @relation(fields: [orderId], references: [id])
  performanceEvents SupplierPerformanceEvent[] @relation("ItemEvents")

  @@index([orderId])
  @@index([productId])
  @@map("purchase_order_items")
}

model PurchaseReceipt {
  id            String        @id @default(cuid())
  receiptNumber String        @unique
  orderId       String
  reference     String?
  status        String        @default("DRAFT")
  receiptDate   DateTime      @default(now())
  notes         String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  createdBy     String?
  updatedBy     String?
  order         PurchaseOrder @relation(fields: [orderId], references: [id])

  @@index([orderId])
  @@index([status])
  @@index([receiptDate])
  @@map("purchase_receipts")
}

model ReportDefinition {
  id               String            @id @default(cuid())
  name             String
  description      String?
  type             String
  category         String
  query            String
  parameters       Json?
  isActive         Boolean           @default(true)
  isSystem         Boolean           @default(false)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  createdBy        String?
  updatedBy        String?
  generatedReports GeneratedReport[]
  scheduledReports ScheduledReport[]

  @@index([type])
  @@index([category])
  @@index([isActive])
  @@map("report_definitions")
}

model GeneratedReport {
  id                 String                   @id @default(cuid())
  reportDefinitionId String
  name               String
  parameters         Json?
  data               Json
  format             String                   @default("JSON")
  status             String                   @default("GENERATING")
  generatedAt        DateTime                 @default(now())
  expiresAt          DateTime?
  fileUrl            String?
  createdAt          DateTime                 @default(now())
  createdBy          String?
  scheduledExecution ScheduledReportExecution @relation("ScheduledExecution", fields: [id], references: [id])
  reportDefinition   ReportDefinition         @relation(fields: [reportDefinitionId], references: [id])

  @@index([reportDefinitionId])
  @@index([status])
  @@index([generatedAt])
  @@index([expiresAt])
  @@map("generated_reports")
}

model ScheduledReport {
  id                  String                            @id @default(cuid())
  reportDefinitionId  String
  name                String
  description         String?
  schedule            String
  scheduleType        String
  isActive            Boolean                           @default(true)
  nextRunAt           DateTime                          @default(now())
  lastRunAt           DateTime?
  parameters          Json?
  format              String                            @default("PDF")
  timezone            String                            @default("UTC")
  sendEmail           Boolean                           @default(true)
  emailRecipients     String[]
  emailSubject        String?
  emailBody           String?
  maxRetries          Int                               @default(3)
  retryInterval       Int                               @default(300)
  archiveAfter        Int?
  deleteAfter         Int?
  createdAt           DateTime                          @default(now())
  updatedAt           DateTime                          @updatedAt
  createdBy           String?
  updatedBy           String?
  distributionLists   ScheduledReportDistributionList[]
  scheduledExecutions ScheduledReportExecution[]
  reportDefinition    ReportDefinition                  @relation(fields: [reportDefinitionId], references: [id])

  @@index([reportDefinitionId])
  @@index([scheduleType])
  @@index([isActive])
  @@index([nextRunAt])
  @@index([lastRunAt])
  @@map("scheduled_reports")
}

model ScheduledReportExecution {
  id                String           @id @default(cuid())
  scheduledReportId String
  scheduledAt       DateTime
  startedAt         DateTime
  completedAt       DateTime?
  status            String           @default("PENDING")
  generatedReportId String?          @unique
  errorMessage      String?
  retryCount        Int              @default(0)
  deliveryStatus    String           @default("PENDING")
  deliveryAttempts  Int              @default(0)
  deliveryLog       Json?
  executionTimeMs   Int?
  createdAt         DateTime         @default(now())
  createdBy         String?
  generatedReport   GeneratedReport? @relation("ScheduledExecution")
  scheduledReport   ScheduledReport  @relation(fields: [scheduledReportId], references: [id])

  @@index([scheduledReportId])
  @@index([status])
  @@index([scheduledAt])
  @@index([deliveryStatus])
  @@map("scheduled_report_executions")
}

model ScheduledReportDistributionList {
  id                String          @id @default(cuid())
  scheduledReportId String
  userId            String
  email             String
  isActive          Boolean         @default(true)
  subscribedAt      DateTime        @default(now())
  unsubscribedAt    DateTime?
  customSubject     String?
  customBody        String?
  deliveryMethod    String          @default("EMAIL")
  preferredFormat   String?
  createdAt         DateTime        @default(now())
  createdBy         String?
  scheduledReport   ScheduledReport @relation(fields: [scheduledReportId], references: [id])
  user              User            @relation(fields: [userId], references: [id])

  @@unique([scheduledReportId, userId])
  @@index([scheduledReportId])
  @@index([userId])
  @@index([isActive])
  @@map("scheduled_report_distribution_lists")
}

model ReportSubscription {
  id                 String   @id @default(cuid())
  userId             String
  reportDefinitionId String
  subscriptionType   String
  isActive           Boolean  @default(true)
  preferences        Json?
  criteria           Json?
  sendEmail          Boolean  @default(true)
  sendInApp          Boolean  @default(true)
  quietHours         Json?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  createdBy          String?
  updatedBy          String?
  user               User     @relation("UserSubscriptions", fields: [userId], references: [id])

  @@unique([userId, reportDefinitionId])
  @@index([userId])
  @@index([reportDefinitionId])
  @@index([subscriptionType])
  @@index([isActive])
  @@map("report_subscriptions")
}

model Dashboard {
  id          String   @id @default(cuid())
  name        String
  description String?
  layout      Json
  widgets     Json
  isActive    Boolean  @default(true)
  isPublic    Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  createdBy   String?
  updatedBy   String?

  @@index([isActive])
  @@index([isPublic])
  @@map("dashboards")
}

model KpiDefinition {
  id          String   @id @default(cuid())
  name        String
  description String?
  category    String
  formula     String
  unit        String?
  target      Decimal? @db.Decimal(15, 2)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  createdBy   String?
  updatedBy   String?

  @@index([category])
  @@index([isActive])
  @@map("kpi_definitions")
}

model SupplierPerformance {
  id                 String                    @id @default(cuid())
  supplierId         String
  period             String
  qualityScore       Decimal                   @default(0) @db.Decimal(5, 2)
  deliveryScore      Decimal                   @default(0) @db.Decimal(5, 2)
  costScore          Decimal                   @default(0) @db.Decimal(5, 2)
  serviceScore       Decimal                   @default(0) @db.Decimal(5, 2)
  overallScore       Decimal                   @default(0) @db.Decimal(5, 2)
  tier               String                    @default("STANDARD")
  onTimeDeliveryRate Decimal                   @default(0) @db.Decimal(5, 2)
  qualityDefectRate  Decimal                   @default(0) @db.Decimal(5, 2)
  orderAccuracyRate  Decimal                   @default(0) @db.Decimal(5, 2)
  priceVarianceRate  Decimal                   @default(0) @db.Decimal(5, 2)
  responseTimeHours  Decimal                   @default(0) @db.Decimal(8, 2)
  totalOrders        Int                       @default(0)
  totalValue         Decimal                   @default(0) @db.Decimal(15, 2)
  lateDeliveries     Int                       @default(0)
  qualityIssues      Int                       @default(0)
  returnsCount       Int                       @default(0)
  notes              String?
  createdAt          DateTime                  @default(now())
  updatedAt          DateTime                  @updatedAt
  calculatedBy       String?
  reviewedBy         String?
  reviewedAt         DateTime?
  calculator         User?                     @relation("PerformanceCalculator", fields: [calculatedBy], references: [id])
  reviewer           User?                     @relation("PerformanceReviewer", fields: [reviewedBy], references: [id])
  supplier           Supplier                  @relation(fields: [supplierId], references: [id])
  scorecardDetails   SupplierScorecardDetail[]

  @@unique([supplierId, period])
  @@index([supplierId])
  @@index([period])
  @@index([tier])
  @@index([overallScore])
  @@index([createdAt])
  @@map("supplier_performance")
}

model SupplierScorecardDetail {
  id               String              @id @default(cuid())
  performanceId    String
  metricType       String
  metricName       String
  metricValue      Decimal             @db.Decimal(15, 2)
  targetValue      Decimal             @db.Decimal(15, 2)
  performanceLevel String
  weight           Decimal             @default(1) @db.Decimal(5, 2)
  score            Decimal             @default(0) @db.Decimal(5, 2)
  trend            String?
  comments         String?
  supportingData   Json?
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt
  performance      SupplierPerformance @relation(fields: [performanceId], references: [id])

  @@index([performanceId])
  @@index([metricType])
  @@index([performanceLevel])
  @@map("supplier_scorecard_details")
}

model SupplierPerformanceEvent {
  id               String             @id @default(cuid())
  supplierId       String
  eventType        String
  eventDate        DateTime
  severity         String
  description      String
  impact           String?
  resolved         Boolean            @default(false)
  resolvedAt       DateTime?
  resolvedBy       String?
  resolutionNotes  String?
  orderId          String?
  itemId           String?
  costImpact       Decimal            @default(0) @db.Decimal(15, 2)
  preventiveAction String?
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  createdBy        String?
  updatedBy        String?
  relatedItem      PurchaseOrderItem? @relation("ItemEvents", fields: [itemId], references: [id])
  relatedOrder     PurchaseOrder?     @relation("OrderEvents", fields: [orderId], references: [id])
  resolver         User?              @relation("EventResolver", fields: [resolvedBy], references: [id])
  supplier         Supplier           @relation("SupplierEvents", fields: [supplierId], references: [id])

  @@index([supplierId])
  @@index([eventType])
  @@index([severity])
  @@index([eventDate])
  @@index([resolved])
  @@map("supplier_performance_events")
}

model SupplierPerformanceReview {
  id               String    @id @default(cuid())
  supplierId       String
  reviewPeriod     String
  reviewType       String
  overallRating    String
  strengths        String[]
  weaknesses       String[]
  recommendations  String[]
  actionItems      Json?
  nextReviewDate   DateTime?
  status           String    @default("PENDING")
  reviewedBy       String
  reviewDate       DateTime  @default(now())
  reviewComments   String?
  followUpRequired Boolean   @default(false)
  followUpDate     DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  completedAt      DateTime?
  reviewer         User      @relation("PerformanceReviewBy", fields: [reviewedBy], references: [id])
  supplier         Supplier  @relation("SupplierReviews", fields: [supplierId], references: [id])

  @@index([supplierId])
  @@index([reviewPeriod])
  @@index([reviewType])
  @@index([overallRating])
  @@index([status])
  @@map("supplier_performance_reviews")
}

model Department {
  id          String       @id @default(cuid())
  code        String       @unique
  name        String
  description String?
  parentId    String?
  managerId   String?      @unique
  isActive    Boolean      @default(true)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  createdBy   String?
  updatedBy   String?
  manager     Employee?    @relation("DepartmentManager", fields: [managerId], references: [id])
  parent      Department?  @relation("DepartmentHierarchy", fields: [parentId], references: [id])
  children    Department[] @relation("DepartmentHierarchy")
  employees   Employee[]

  @@index([parentId])
  @@index([isActive])
  @@index([managerId])
  @@map("departments")
}

model Employee {
  id                   String              @id @default(cuid())
  employeeId           String              @unique
  userId               String              @unique
  firstName            String
  lastName             String
  email                String              @unique
  phone                String?
  address              String?
  city                 String?
  state                String?
  postalCode           String?
  country              String?
  dateOfBirth          DateTime
  hireDate             DateTime            @default(now())
  departmentId         String
  position             String
  jobTitle             String
  employmentType       String              @default("FULL_TIME")
  status               String              @default("ACTIVE")
  salary               Decimal             @db.Decimal(12, 2)
  currency             String              @default("USD")
  workSchedule         Json?
  emergencyContact     Json?
  socialSecurity       String?
  taxId                String?
  bankAccount          Json?
  isActive             Boolean             @default(true)
  performanceRating    Decimal?            @db.Decimal(3, 1)
  lastReviewDate       DateTime?
  nextReviewDate       DateTime?
  annualLeaveBalance   Decimal             @default(0) @db.Decimal(5, 2)
  sickLeaveBalance     Decimal             @default(0) @db.Decimal(5, 2)
  personalLeaveBalance Decimal             @default(0) @db.Decimal(5, 2)
  createdAt            DateTime            @default(now())
  updatedAt            DateTime            @updatedAt
  createdBy            String?
  updatedBy            String?
  terminatedAt         DateTime?
  terminationReason    String?
  managedDepartment    Department?         @relation("DepartmentManager")
  department           Department          @relation(fields: [departmentId], references: [id])
  user                 User                @relation("EmployeeUser", fields: [userId], references: [id])
  leaveRequests        LeaveRequest[]
  payrollRecords       PayrollRecord[]
  performanceReviews   PerformanceReview[]
  timesheets           Timesheet[]

  @@index([employeeId])
  @@index([userId])
  @@index([email])
  @@index([departmentId])
  @@index([status])
  @@index([isActive])
  @@index([hireDate])
  @@map("employees")
}

model PayrollRecord {
  id                String    @id @default(cuid())
  employeeId        String
  payPeriod         String
  grossPay          Decimal   @db.Decimal(12, 2)
  netPay            Decimal   @db.Decimal(12, 2)
  currency          String    @default("USD")
  federalTax        Decimal   @default(0) @db.Decimal(10, 2)
  stateTax          Decimal   @default(0) @db.Decimal(10, 2)
  socialSecurityTax Decimal   @default(0) @db.Decimal(10, 2)
  medicareTax       Decimal   @default(0) @db.Decimal(10, 2)
  otherDeductions   Decimal   @default(0) @db.Decimal(10, 2)
  totalDeductions   Decimal   @default(0) @db.Decimal(10, 2)
  healthInsurance   Decimal   @default(0) @db.Decimal(10, 2)
  dentalInsurance   Decimal   @default(0) @db.Decimal(10, 2)
  retirement401k    Decimal   @default(0) @db.Decimal(10, 2)
  otherBenefits     Decimal   @default(0) @db.Decimal(10, 2)
  totalBenefits     Decimal   @default(0) @db.Decimal(10, 2)
  regularHours      Decimal   @default(0) @db.Decimal(6, 2)
  overtimeHours     Decimal   @default(0) @db.Decimal(6, 2)
  hourlyRate        Decimal   @db.Decimal(8, 2)
  overtimeRate      Decimal   @db.Decimal(8, 2)
  paymentMethod     String    @default("DIRECT_DEPOSIT")
  paymentDate       DateTime  @default(now())
  paymentStatus     String    @default("PENDING")
  transactionId     String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  processedBy       String?
  approvedBy        String?
  approvedAt        DateTime?
  employee          Employee  @relation(fields: [employeeId], references: [id])

  @@unique([employeeId, payPeriod])
  @@index([employeeId])
  @@index([payPeriod])
  @@index([paymentDate])
  @@index([paymentStatus])
  @@map("payroll_records")
}

model LeaveRequest {
  id              String    @id @default(cuid())
  employeeId      String
  leaveType       String
  startDate       DateTime
  endDate         DateTime
  daysRequested   Decimal   @db.Decimal(4, 1)
  reason          String?
  status          String    @default("PENDING")
  approvedBy      String?
  approvedAt      DateTime?
  rejectedBy      String?
  rejectedAt      DateTime?
  rejectionReason String?
  paidLeave       Boolean   @default(true)
  payRate         Decimal?  @db.Decimal(8, 2)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  createdBy       String?
  updatedBy       String?
  employee        Employee  @relation(fields: [employeeId], references: [id])

  @@index([employeeId])
  @@index([leaveType])
  @@index([status])
  @@index([startDate])
  @@index([endDate])
  @@map("leave_requests")
}

model PerformanceReview {
  id                 String    @id @default(cuid())
  employeeId         String
  reviewerId         String
  reviewPeriod       String
  reviewType         String
  overallRating      Decimal   @db.Decimal(3, 1)
  qualityRating      Decimal   @db.Decimal(3, 1)
  productivityRating Decimal   @db.Decimal(3, 1)
  teamworkRating     Decimal   @db.Decimal(3, 1)
  initiativeRating   Decimal   @db.Decimal(3, 1)
  attendanceRating   Decimal   @db.Decimal(3, 1)
  strengths          String[]
  weaknesses         String[]
  goals              String[]
  recommendations    String[]
  actionItems        Json?
  status             String    @default("DRAFT")
  reviewDate         DateTime  @default(now())
  nextReviewDate     DateTime?
  employeeComments   String?
  reviewerComments   String?
  finalComments      String?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  completedAt        DateTime?
  employee           Employee  @relation(fields: [employeeId], references: [id])

  @@index([employeeId])
  @@index([reviewerId])
  @@index([reviewPeriod])
  @@index([reviewType])
  @@index([overallRating])
  @@index([status])
  @@map("performance_reviews")
}

model Timesheet {
  id            String           @id @default(cuid())
  employeeId    String
  weekStartDate DateTime
  status        String           @default("DRAFT")
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
  submittedBy   String?
  submittedAt   DateTime?
  approvedBy    String?
  approvedAt    DateTime?
  entries       TimesheetEntry[]
  employee      Employee         @relation(fields: [employeeId], references: [id])

  @@unique([employeeId, weekStartDate])
  @@index([employeeId])
  @@index([weekStartDate])
  @@index([status])
  @@map("timesheets")
}

model TimesheetEntry {
  id          String    @id @default(cuid())
  timesheetId String
  date        DateTime
  projectCode String?
  taskType    String
  hoursWorked Decimal   @db.Decimal(4, 2)
  description String?
  createdAt   DateTime  @default(now())
  timesheet   Timesheet @relation(fields: [timesheetId], references: [id])

  @@index([timesheetId])
  @@index([date])
  @@index([taskType])
  @@map("timesheet_entries")
}

model ResourceLock {
  id           String   @id @default(cuid())
  resourceType String
  resourceId   String
  lockType     String
  userId       String?
  expiresAt    DateTime
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  user         User?    @relation(fields: [userId], references: [id])

  @@unique([resourceType, resourceId, isActive])
  @@index([resourceType, resourceId])
  @@index([expiresAt])
  @@index([isActive])
  @@map("resource_locks")
}

model AuditLog {
  id           String   @id @default(cuid())
  eventType    String
  resourceType String
  resourceId   String
  action       String
  userId       String?
  oldValues    Json?
  newValues    Json?
  metadata     Json?
  ipAddress    String?
  userAgent    String?
  correlationId String?
  severity     String   @default("INFO")
  timestamp    DateTime @default(now())

  // Indexes for performance and querying
  @@index([eventType])
  @@index([resourceType, resourceId])
  @@index([userId])
  @@index([timestamp])
  @@index([severity])
  @@index([correlationId])
  @@map("audit_logs")
}

// Inventory Valuation Models
model InventoryValuation {
  id            String   @id @default(cuid())
  productId     String
  method        String   @default("WEIGHTED_AVERAGE")
  quantity      Int      @default(0)
  unitCost      Decimal  @default(0) @db.Decimal(10, 2)
  totalValue    Decimal  @default(0) @db.Decimal(15, 2)
  valuationDate DateTime @default(now())
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  createdBy     String?
  updatedBy     String?
  product       Product  @relation(fields: [productId], references: [id])

  @@index([productId])
  @@index([method])
  @@index([valuationDate])
  @@index([isActive])
  @@map("inventory_valuations")
}

model CostLayer {
  id                String   @id @default(cuid())
  productId         String
  batchNumber       String?
  quantity          Int      @default(0)
  unitCost          Decimal  @default(0) @db.Decimal(10, 2)
  totalCost         Decimal  @default(0) @db.Decimal(15, 2)
  remainingQuantity Int      @default(0)
  acquisitionDate   DateTime @default(now())
  expiryDate        DateTime?
  supplierId        String?
  purchaseOrderId   String?
  location          String?
  isActive          Boolean  @default(true)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  product           Product  @relation(fields: [productId], references: [id])

  @@index([productId])
  @@index([acquisitionDate])
  @@index([expiryDate])
  @@index([isActive])
  @@index([remainingQuantity])
  @@map("cost_layers")
}

model Warehouse {
  id                String    @id @default(cuid())
  name              String
  code              String    @unique
  address           String?
  city              String?
  state             String?
  country           String?
  postalCode        String?
  contactPerson     String?
  contactPhone      String?
  contactEmail      String?
  maxCapacity       Int?
  currentUtilization Int     @default(0)
  operatingHours    String?
  status            String    @default("ACTIVE")
  isActive          Boolean   @default(true)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  createdBy         String?
  updatedBy         String?
  notes             String?

  @@index([code])
  @@index([status])
  @@index([isActive])
  @@map("warehouses")
}

model LowStockAlert {
  id                String   @id @default(cuid())
  productId         String
  currentStock      Int
  lowStockThreshold Int
  stockDeficit      Int
  severity          String   @default("MEDIUM")
  isActive          Boolean  @default(true)
  isAcknowledged    Boolean  @default(false)
  acknowledgedAt    DateTime?
  acknowledgedBy    String?
  reorderQuantity   Int?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  product           Product  @relation(fields: [productId], references: [id])

  @@index([productId])
  @@index([severity])
  @@index([isActive])
  @@index([isAcknowledged])
  @@map("low_stock_alerts")
}
// P2P (Procure-to-Pay) Schema Models
// These models extend the existing schema with P2P-specific entities

model PurchaseRequisition {
  id               String               @id @default(cuid())
  requestNumber    String               @unique
  title            String
  description      String?
  requestorId      String
  departmentId     String
  priority         String               @default("NORMAL")
  type             String               @default("STOCK")
  status           String               @default("DRAFT")
  totalAmount      Decimal              @default(0) @db.Decimal(15, 2)
  currency         String               @default("USD")
  requiredDate     DateTime
  justification    String?
  submittedAt      DateTime?
  approvedAt       DateTime?
  completedAt      DateTime?
  cancelledAt      DateTime?
  createdAt        DateTime             @default(now())
  updatedAt        DateTime             @updatedAt
  createdBy        String?
  updatedBy        String?

  // Relations
  items            RequisitionItem[]
  approvals        RequisitionApproval[]
  purchaseOrders   PurchaseOrderEnhanced[]

  @@index([requestNumber])
  @@index([status])
  @@index([requestorId])
  @@index([departmentId])
  @@index([priority])
  @@index([requiredDate])
  @@index([createdAt])
  @@map("purchase_requisitions")
}

model RequisitionItem {
  id                     String             @id @default(cuid())
  requisitionId          String
  productId              String?
  description            String
  quantity               Int
  unitPrice              Decimal?           @db.Decimal(10, 2)
  estimatedPrice         Decimal            @db.Decimal(10, 2)
  currency               String             @default("USD")
  uom                    String
  specifications         String?
  preferredSupplier      String?
  suggestedSuppliers     String?
  category               String
  requestedDeliveryDate  DateTime
  notes                  String?
  createdAt              DateTime           @default(now())
  updatedAt              DateTime           @updatedAt

  // Relations
  requisition            PurchaseRequisition @relation(fields: [requisitionId], references: [id], onDelete: Cascade)

  @@index([requisitionId])
  @@index([productId])
  @@index([category])
  @@map("requisition_items")
}

model RequisitionApproval {
  id            String   @id @default(cuid())
  requisitionId String
  approverId    String
  approverName  String
  approverRole  String
  status        String   @default("PENDING")
  comments      String?
  approvedAt    DateTime?
  level         Int
  isRequired    Boolean  @default(true)
  isDelegated   Boolean  @default(false)
  delegatedTo   String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  requisition   PurchaseRequisition @relation(fields: [requisitionId], references: [id], onDelete: Cascade)

  @@index([requisitionId])
  @@index([approverId])
  @@index([status])
  @@index([level])
  @@map("requisition_approvals")
}

model SupplierQualification {
  id               String    @id @default(cuid())
  supplierId       String
  category         String
  status           String    @default("PENDING")
  score            Decimal   @default(0) @db.Decimal(5, 2)
  certifications   Json?
  capabilities     Json?
  performanceHistory Json?
  validFrom        DateTime  @default(now())
  validUntil       DateTime?
  approvedBy       String?
  approvedAt       DateTime?
  lastReviewDate   DateTime  @default(now())
  nextReviewDate   DateTime
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  @@index([supplierId])
  @@index([category])
  @@index([status])
  @@index([validFrom])
  @@index([validUntil])
  @@map("supplier_qualifications")
}

model PurchaseOrderEnhanced {
  id                    String                     @id @default(cuid())
  orderNumber           String                     @unique
  requisitionId         String?
  supplierId            String
  status                String                     @default("DRAFT")
  orderDate             DateTime                   @default(now())
  expectedDeliveryDate  DateTime?
  actualDeliveryDate    DateTime?
  subtotal              Decimal                    @default(0) @db.Decimal(15, 2)
  taxAmount             Decimal                    @default(0) @db.Decimal(15, 2)
  totalAmount           Decimal                    @default(0) @db.Decimal(15, 2)
  currency              String                     @default("USD")
  paymentTerms          String                     @default("NET30")
  deliveryTerms         String?
  shippingAddress       Json?
  billingAddress        Json?
  notes                 String?
  sentAt                DateTime?
  confirmedAt           DateTime?
  approvedAt            DateTime?
  closedAt              DateTime?
  createdAt             DateTime                   @default(now())
  updatedAt             DateTime                   @updatedAt
  createdBy             String?
  updatedBy             String?

  // Relations
  requisition           PurchaseRequisition?      @relation(fields: [requisitionId], references: [id])
  items                 PurchaseOrderItemEnhanced[]
  approvals             PurchaseOrderApproval[]
  receipts              PurchaseReceiptEnhanced[]
  invoices              InvoiceEnhanced[]

  @@index([orderNumber])
  @@index([status])
  @@index([supplierId])
  @@index([orderDate])
  @@index([expectedDeliveryDate])
  @@map("purchase_orders_enhanced")
}

model PurchaseOrderItemEnhanced {
  id                     String                     @id @default(cuid())
  orderId                String
  requisitionItemId      String?
  productId              String?
  supplierSku            String?
  description            String
  quantity               Int
  unitPrice              Decimal                    @db.Decimal(10, 2)
  totalPrice             Decimal                    @default(0) @db.Decimal(15, 2)
  currency               String                     @default("USD")
  discount               Decimal                    @default(0) @db.Decimal(10, 2)
  taxRate                Decimal                    @default(0) @db.Decimal(5, 4)
  taxAmount              Decimal                    @default(0) @db.Decimal(15, 2)
  uom                    String
  expectedDeliveryDate   DateTime
  actualDeliveryDate     DateTime?
  specifications         String?
  qualityRequirements    String?
  receivedQuantity       Int                        @default(0)
  acceptedQuantity       Int                        @default(0)
  rejectedQuantity       Int                        @default(0)
  batchNumber            String?
  expiryDate             DateTime?
  lotNumber              String?
  serialNumbers          String?
  storageLocation        String?
  notes                  String?
  createdAt              DateTime                   @default(now())
  updatedAt              DateTime                   @updatedAt

  // Relations
  order                  PurchaseOrderEnhanced      @relation(fields: [orderId], references: [id], onDelete: Cascade)
  receiptItems           ReceiptItem[]

  @@index([orderId])
  @@index([productId])
  @@index([expectedDeliveryDate])
  @@map("purchase_order_items_enhanced")
}

model PurchaseOrderApproval {
  id            String   @id @default(cuid())
  orderId       String
  approverId    String
  approverName  String
  approverRole  String
  status        String   @default("PENDING")
  comments      String?
  approvedAt    DateTime?
  level         Int
  isRequired    Boolean  @default(true)
  delegationChain String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  order         PurchaseOrderEnhanced @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([approverId])
  @@index([status])
  @@index([level])
  @@map("purchase_order_approvals")
}

model PurchaseReceiptEnhanced {
  id                   String              @id @default(cuid())
  receiptNumber        String              @unique
  orderId              String
  status               String              @default("DRAFT")
  receiptDate          DateTime            @default(now())
  receivedBy           String
  deliveryNoteNumber   String?
  carrier              String?
  vehicleNumber        String?
  notes                String?
  completedAt          DateTime?
  createdAt            DateTime            @default(now())
  updatedAt            DateTime            @updatedAt
  createdBy            String?
  updatedBy            String?

  // Relations
  order                PurchaseOrderEnhanced @relation(fields: [orderId], references: [id])
  items                ReceiptItem[]
  inspections          QualityInspection[]

  @@index([receiptNumber])
  @@index([orderId])
  @@index([status])
  @@index([receiptDate])
  @@map("purchase_receipts_enhanced")
}

model ReceiptItem {
  id                String                @id @default(cuid())
  receiptId         String
  orderItemId       String
  productId         String?
  description       String
  orderedQuantity   Int
  receivedQuantity  Int
  acceptedQuantity  Int                   @default(0)
  rejectedQuantity  Int                   @default(0)
  pendingQuantity   Int                   @default(0)
  unitPrice         Decimal               @db.Decimal(10, 2)
  batchNumber       String?
  expiryDate        DateTime?
  lotNumber         String?
  serialNumbers     String?
  storageLocation   String?
  condition         String                @default("EXCELLENT")
  notes             String?
  createdAt         DateTime              @default(now())
  updatedAt         DateTime              @updatedAt

  // Relations
  receipt           PurchaseReceiptEnhanced @relation(fields: [receiptId], references: [id], onDelete: Cascade)
  orderItem         PurchaseOrderItemEnhanced @relation(fields: [orderItemId], references: [id])
  inspections       QualityInspection[]

  @@index([receiptId])
  @@index([orderItemId])
  @@index([productId])
  @@map("receipt_items")
}

model QualityInspection {
  id                  String          @id @default(cuid())
  receiptId           String
  receiptItemId       String
  inspectorId         String
  inspectorName       String
  inspectionDate      DateTime        @default(now())
  status              String          @default("PENDING")
  overallResult       String?
  criteria            Json?
  defects             Json?
  recommendations     String?
  nextInspectionDate  DateTime?
  documents           String?
  notes               String?
  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt

  // Relations
  receipt             PurchaseReceiptEnhanced @relation(fields: [receiptId], references: [id], onDelete: Cascade)
  receiptItem         ReceiptItem     @relation(fields: [receiptItemId], references: [id], onDelete: Cascade)

  @@index([receiptId])
  @@index([receiptItemId])
  @@index([inspectorId])
  @@index([inspectionDate])
  @@index([status])
  @@map("quality_inspections")
}

model InvoiceEnhanced {
  id                    String               @id @default(cuid())
  invoiceNumber         String               @unique
  orderId               String
  supplierId            String
  status                String               @default("DRAFT")
  invoiceDate           DateTime             @default(now())
  dueDate               DateTime
  currency              String               @default("USD")
  subtotal              Decimal              @default(0) @db.Decimal(15, 2)
  taxAmount             Decimal              @default(0) @db.Decimal(15, 2)
  totalAmount           Decimal              @default(0) @db.Decimal(15, 2)
  discountAmount        Decimal?             @db.Decimal(15, 2)
  paidAmount            Decimal              @default(0) @db.Decimal(15, 2)
  balanceAmount         Decimal              @db.Decimal(15, 2)
  matchingStatus        String               @default("PENDING")
  receivedAt            DateTime?
  approvedAt            DateTime?
  paidAt                DateTime?
  cancelledAt           DateTime?
  notes                 String?
  attachments           String?
  createdAt             DateTime             @default(now())
  updatedAt             DateTime             @updatedAt
  createdBy             String?
  updatedBy             String?

  // Relations
  order                 PurchaseOrderEnhanced @relation(fields: [orderId], references: [id])
  matchingDetails       MatchingDetail[]
  approvals             InvoiceApproval[]
  payments              P2PPayment[]

  @@index([invoiceNumber])
  @@index([orderId])
  @@index([supplierId])
  @@index([status])
  @@index([invoiceDate])
  @@index([dueDate])
  @@map("invoices_enhanced")
}

model MatchingDetail {
  id                String         @id @default(cuid())
  invoiceId         String
  orderId           String
  receiptId         String?
  type              String         @default("THREE_WAY")
  status            String         @default("PENDING")
  poAmount          Decimal        @db.Decimal(15, 2)
  receiptAmount     Decimal        @db.Decimal(15, 2)
  invoiceAmount     Decimal        @db.Decimal(15, 2)
  varianceAmount    Decimal        @db.Decimal(15, 2)
  variancePercentage Decimal        @db.Decimal(5, 2)
  tolerance         Decimal        @db.Decimal(5, 2)
  issues            Json?
  resolvedAt        DateTime?
  resolvedBy        String?
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt

  // Relations
  invoice           InvoiceEnhanced @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@index([invoiceId])
  @@index([orderId])
  @@index([status])
  @@map("matching_details")
}

model InvoiceApproval {
  id            String   @id @default(cuid())
  invoiceId     String
  approverId    String
  approverName  String
  approverRole  String
  status        String   @default("PENDING")
  comments      String?
  approvedAt    DateTime?
  level         Int
  isRequired    Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  invoice       InvoiceEnhanced @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@index([invoiceId])
  @@index([approverId])
  @@index([status])
  @@index([level])
  @@map("invoice_approvals")
}

model P2PPayment {
  id                String   @id @default(cuid())
  paymentNumber     String   @unique
  invoiceId         String
  supplierId        String
  status            String   @default("PENDING")
  amount            Decimal  @db.Decimal(15, 2)
  currency          String   @default("USD")
  paymentDate       DateTime
  scheduledDate     DateTime?
  paymentMethod     String?
  referenceNumber   String?
  bankAccount       String?
  approvalRequired  Boolean  @default(false)
  approvedBy        String?
  approvedAt        DateTime?
  processedBy       String?
  processedAt       DateTime?
  notes             String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  invoice           InvoiceEnhanced @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@index([paymentNumber])
  @@index([invoiceId])
  @@index([supplierId])
  @@index([status])
  @@index([paymentDate])
  @@index([scheduledDate])
  @@map("p2p_payments")
}

// Event Store Models for Phase 6 Event Bus System
model Event {
  id          String   @id @default(cuid())
  aggregateId String
  aggregateType String
  eventType   String
  eventData   Json
  eventDataV2 Json?   // For event versioning
  eventVersion Int    @default(1)
  metadata    Json?
  causationId String? // For event causation
  correlationId String?
  eventId     String   @unique
  occurredAt  DateTime @default(now())
  processedAt DateTime?
  streamId    String?
  stream      EventStream? @relation(fields: [streamId], references: [id])

  @@index([aggregateId, aggregateType])
  @@index([eventType])
  @@index([occurredAt])
  @@index([eventId])
  @@index([streamId])
  @@map("events")
}

model EventStream {
  id          String   @id @default(cuid())
  streamId    String   @unique
  aggregateId String
  aggregateType String
  version     Int      @default(0)
  events      Event[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([aggregateId, aggregateType])
  @@index([streamId])
  @@map("event_streams")
}

model EventSnapshot {
  id          String   @id @default(cuid())
  aggregateId String
  aggregateType String
  version     Int
  data        Json
  metadata    Json?
  createdAt   DateTime @default(now())

  @@index([aggregateId, aggregateType])
  @@index([version])
  @@map("event_snapshots")
}

model DeadLetterEvent {
  id             String   @id @default(cuid())
  eventId        String   @unique
  eventType      String
  eventData      Json
  aggregateId    String
  aggregateType  String
  errorType      String
  errorMessage   String?
  errorStack     String?
  handlerName    String?
  retryCount     Int      @default(0)
  maxRetries     Int      @default(3)
  retryAfter     DateTime?
  lastRetryAt    DateTime?
  failureContext Json?
  metadata       Json?
  severity       String   @default("low")
  status         String   @default("pending")
  removedAt      DateTime?
  removalReason  String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([eventType])
  @@index([aggregateId, aggregateType])
  @@index([severity])
  @@index([status])
  @@index([retryCount])
  @@index([retryAfter])
  @@index([createdAt])
  @@map("dead_letter_events")
}